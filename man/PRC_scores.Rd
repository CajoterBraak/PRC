% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/PRC_scores.r
\name{PRC_scores}
\alias{PRC_scores}
\title{Calculate principal response curve (PRC) scores from vegan::rda, cca, dbrda or capscale objects}
\usage{
PRC_scores(
  object,
  focal_factor_name = NULL,
  referencelevel = NULL,
  rank = 2,
  flip = rep(FALSE, rank),
  scaling = "ms",
  data
)
}
\arguments{
\item{object}{a \code{vegan} \code{\link[vegan]{cca.object}},
 a result of \code{\link[vegan]{rda}}, \code{\link[vegan]{cca}},
\code{\link[vegan]{dbrda}} or \code{\link[vegan]{capscale}} with model specified via a formula.}

\item{focal_factor_name}{name of one or two focal factors (the treatment(s) of interest); if unspecified,
derived from the formula in \code{object} via the function \code{\link{get_focal_and_conditioning_factors}}.}

\item{referencelevel}{numeric or character level(s) to be used as reference of the \code{focal_factor_name}(s); default: 1.}

\item{rank}{number of axes to be computed; default 2.}

\item{flip}{logical value or vector; default: FALSE. Should the axes be flipped,
i.e. reversed in orientation? \code{flip} can be numeric with values -1 and 1
for reverse and no reverse, respectively,
i.e. multiply the scores by either -1 or 1.}

\item{scaling}{character ("ms", "ss"). Scales the axes of an RDA object to mean square species scores of 1 ("ms") or
 a sum of squares of 1 ("ss"). The only scaling for a CCA  object is "ss" (weighted mean square = 1, with weight =
 species total abundance). For a dbrda object, there are no species scores and the scaling is like "ss".
The default scaling ("ms" for RDA and "ss" for CCA) has the advantage that
                  the PRC treatment and sample scores measure the effect sizes of the 'average' species
                  as their (weigthed) mean square is 1 (sd = 1); it is the scaling used in Canoco5 (www.canoco5.com).
                  Scaling "ss" is the default in  \code{\link[stats]{prcomp}}
                  and used in ter Braak 2023.}

\item{data}{data frame of the experimental design used in the call
to \code{\link[vegan]{rda}} or \code{\link[vegan]{cca}}}
}
\value{
A named list:
\itemize{
\item{PRCplus:} { a data frame that combines the design in \code{data} with the PRC and RDA/CCA scores
with ("_E") and without error (the unconstrained [sites] and constrained [LC] scores, respectively),
and, finally, the reference scores. Note that
PRC1_E = RDA1_E - RDA1_Ref, etc for other axes}
\item{species:} { a matrix with the loadings with respect to the PRC scores; NULL if the \code{object} lacks loadings.}
\item{reference_scores:} { a matrix with the scores of each unit in \code{data} with the level of the focal factor
 replaced by the reference level}
\item{focal_factor_name:} { name of the focal factor in the call to \code{PRC_scores}}
\item{referencelevel:} { referencelevel in the call to \code{PRC_scores}}
\item{coefficients:} { list of PRC-coefficients for each axis (matrix if rank is equal to 1)}
\item{focal_and_conditioning_factors:}{ list of focal and conditioning factors; obtained from
\code{\link{get_focal_and_conditioning_factors}} if argument \code{focal_factor_name} in the call is unset.}
\item{terms:}{ object$terms. See \code{\link[vegan]{cca.object}}}.
\item{terminfo:}{ object$terminfo. See \code{\link[vegan]{cca.object}}}.
\item{method:}{ object$method. See \code{\link[vegan]{cca.object}}}.
\item{percExp:}{ percentage variance of each axis out of the variance that can be explained by the predictors and covariates}.
}
}
\description{
\code{PRC_scores} calculates scores to display principal response curves with
scores for individual plots from a vegan constrained ordination object (\code{\link[vegan]{cca.object}}).
}
\details{
\code{PRC_scores} uses \code{\link[vegan]{scores}} to
calculate the loadings (species scores),if obtainable from the \code{object}, and the constrained and unconstrained sample scores
of the units in \code{data}. The PRC treatment and sample scores are obtained by subtracting the reference scores
from the constrained and unconstrained scores, respectively.
The reference scores are calculated by applying \code{\link[stats]{predict}}
with \code{type = "lc"} on \code{newdata}, which
equals \code{data}, except that the level of the focal factor of each unit is changed to the reference level.
By this simple method, \code{prc scores} can be applied with and without terms in \code{Condition()}
in the \code{formula} of the call to \code{\link[vegan]{rda}}, \code{\link[vegan]{cca}},
\code{\link[vegan]{dbrda}} or \code{\link[vegan]{capscale}}.
There can thus be additional (perhaps quantitative) covariates,
 \code{A:B+ Condition(A+other_covariates)} where the focal factor is B,
 and also with three (instead of two factors) e.g.
 with formula \code{ A*B*C + Condition(A*C)} so as to display the A*C-dependent effects of focal factor B
 on the multivariate response in the call to \code{\link[vegan]{rda}}, \code{\link[vegan]{cca}},
\code{\link[vegan]{dbrda}} or \code{\link[vegan]{capscale}}.
 The element \code{object$'focal_and_conditioning_factors'} in value is set
 by applying the function \code{\link{get_focal_and_conditioning_factors}}
 to the ordination model specified in \code{object}.

 CCA-based PRC is useful in data with many zeroes and which are strictly compositional,
 i.e. have row sums that have no meaning for the question of interest (ter Braak and te Beest, 2022).
 A layman's example is that
 the weight of a cake is not important for its taste; taste depends on its composition only.
 CCA can be applied without log-transforming the data and thereby avoids the issue of
 replacement of zeroes (ter Braak and te Beest, 2022).
}
\examples{
data(pyrifos, package = "vegan") #transformed species data from package vegan
#the chlorpyrifos experiment from van den Brink & ter Braak 1999
Design <- data.frame(week=gl(11, 12, labels=c(-4, -1, 0.1, 1, 2, 4, 8, 12, 15, 19, 24)),
                     dose=factor(rep(c(0.1, 0, 0, 0.9, 0, 44, 6, 0.1, 44, 0.9, 0, 6), 11)),
                     ditch = gl(12, 1, length=132))

mod_rda <- rda( pyrifos ~ dose:week + Condition(week),  data = Design)
Design_w_PRCs <- PRC_scores(mod_rda, focal_factor_name= "dose", referencelevel = "0",
                            rank = 2, data= Design, scaling ="ms", flip = FALSE)

plot_sample_scores_cdt(Design_w_PRCs, plot = "ditch")
plot_sample_scores_cdt(Design_w_PRCs)
plot_sample_scores_cdt(Design_w_PRCs, plot = "Ditch")


}
\seealso{
\code{\link[PRC]{plotPRC}}, \code{\link[PRC]{plotPRC2d}}
}
