% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plotPRC2d.R
\name{plotPRC2d}
\alias{plotPRC2d}
\title{2d PRC diagram}
\usage{
plotPRC2d(
  object,
  treatment = NULL,
  condition = NULL,
  plot = 1,
  xvals = NULL,
  axes = c(1, 2),
  threshold = 7,
  title = NULL,
  left = NULL,
  right = NULL,
  speciesname = NULL,
  selectname = "Fratio",
  xylab = NULL,
  label.repel = FALSE,
  withnames_only = FALSE,
  max.overlaps = 10,
  mult_expand = 0.1,
  widths = c(3, 2),
  verbose = TRUE
)
}
\arguments{
\item{object}{a result of \code{\link{PRC_scores}} or a list with element
PRCplus (a data frame with a variables to plot, see details).}

\item{treatment}{character vector of names of factors in \code{object$PRCplus},
 the first two of which set the \code{color} and \code{linetype} of treatments.
Default: derived from \code{object$'focal_and_conditioning_factors'}.}

\item{condition}{character vector of names of factors in \code{object$PRCplus}, the first one being used as x-axis.
Default: derived from \code{object$'focal_and_conditioning_factors'}.}

\item{plot}{0 or 1 ((no/yes individual plot points)) or
character name of a factor in \code{object$PRCplus} indicating the plots
(microcosms, subjects or objects) in a longitudinal study so as to plot lines.
Default: 1 yielding points instead of lines.}

\item{xvals}{numeric values for the levels of the condition factor,
or name of numeric variable in \code{object$PRCplus} to be used for the x-axis. Default: NULL for which the values are
obtained using the function \code{\link{fvalues4levels}} applied to \code{object$PRCplus[[condition[1]]]}}

\item{axes}{axes shown; default \code{c(1,2)} showing the first two PRC axes.}

\item{threshold}{species with criterion (specified by \code{selectname}) higher than the \code{threshold} are displayed.
Default: 5
(which is the threshold F-ratio for testing two regression coefficients (one for each axis)
at \code{p=0.01} with \code{60} df for the error in a multiple regression
of each single species onto the condition and the ordination axes).
If \code{selectname}  is not in the data the \code{threshold} is divided by ten, so that the default is 0.5.}

\item{title}{overall title.}

\item{left}{left axis text (see \code{\link[gridExtra]{arrangeGrob}}).}

\item{right}{right axis text (see \code{\link[gridExtra]{arrangeGrob}})}

\item{speciesname}{name of the variable containing the species names (default \code{NULL} uses rownames)}

\item{selectname}{name of the column or variable containing the criterion for the selection of species to be displayed
Default: \code{"Fratio"}; if \code{selectname} is not found in \code{object$species_scores},
set to the Euclidian norm (length) of the vectors defined by row-wise combining the values defined by \code{scorenames}.}

\item{xylab}{character vector of length 2 defining x- and y-axis title of the species ordination so as to overwrite the defauls axis labels}

\item{label.repel}{logical (default: \code{FALSE}) for using labels in white boxes with borders using \code{\link[ggrepel]{geom_label_repel}}
instead of using plain text labels using \code{\link[ggrepel]{geom_text_repel}}.}

\item{withnames_only}{plot the species that exceed the \code{treshold} only.}

\item{max.overlaps}{exclude text labels that overlap too many things. Default: 10 (see \code{\link[ggrepel]{geom_text_repel}}).}

\item{mult_expand}{fraction of range expansion of the diagram (default = 0.1). See \code{\link[ggplot2]{expansion}}.}

\item{verbose}{locigal for printing the number of species with names out of the total number (default: \code{TRUE}).}
}
\value{
a list of a gridExtra object (plot using \code{\link[gridExtra]{arrangeGrob}})
and a list of five ggplot2 objects, arranged in a list of two: treatments = the  PRC1, PRC2-diagrams with line x=y and x= -y diagrams
and and species= the 2d species ordination plot).
}
\description{
\code{plotPRC2d} creates a two-dimensional PRC diagram with species loadings from a result of \code{\link{PRC_scores}}
}
\details{
The function creates the treatment PRC diagrams for the \code{axes} using \code{\link{plot_sample_scores_cdt}}, with diagrams for the
\code{x=y} and \code{x=-y} directions, and the
2d species loading plot using \code{\link{plot_species_scores_2d}}. These ggplot2-objects are
combined in a single object using \code{\link[gridExtra]{arrangeGrob}}.
}
\examples{

data("CPFNUT_phytoplankton")

# Read example data ----------------------------------------------------


names(CPFNUT_phytoplankton)[1:6]
Design <- CPFNUT_phytoplankton[,c("Time","Treatment","Plot","con_nut_cpf")]
summary(Design)
print(with(Design,table(Time,Treatment)))

# extract response variables
Counts <- as.matrix(CPFNUT_phytoplankton[,-(1:5)]); rownames(Counts)<-CPFNUT_phytoplankton$sample
# transform as a multiplicative model is more logical than an additive one.
# But need to add pseudocount to avoid log(0) = infinite

Y <- log(Counts+1)
# Remark: this transformation reproduces the results in van den Brink & ter Braak 1998
#         apart from scaling (but the product b_k*c_dt is identical) and
#         apart from the PRC1 score at week 4, which is erroneous in the paper.
# PRC via vegan -----------------------------------------------------------

mod_prc <- doPRC( Y~ Time * Treatment + Condition(Time),  rank = 3, data= Design, flip= c(FALSE, TRUE, FALSE))
round(mod_prc$percExp, 0)

plotPRC(mod_prc, plot = "Plot", width = c(2,1), symbols_on_curves = TRUE)

plotPRC(mod_prc, plot = "Plot", width = c(2,1), axis = 2)
# note that the default selection criterion "Fratio2" also selects species strongly reacting to axis 1

plotPRC2d(mod_prc, plot = 0, threshold = 1,title = "PRC Phytoplankton van den Brink & ter Braak (1998)")

# modifying the plot
# Assign the plots to symbols and use grid.arrange to produce the plot you like, for example:
gg <- plotPRC2d(mod_prc, plot = 0, verbose = FALSE)
pl_species <- gg$separateplots$species # species ordination
pl <- gg$separateplots$treatments
names(pl)

layout<- rbind(c(1,2), c(3,4),c(3,5))
gridExtra::grid.arrange(pl[["PRC1"]]+ggplot2::ylab("PRC1")+ggplot2::ggtitle(""),
                        pl[["PRC2"]]+ggplot2::ylab("PRC2")+ggplot2::xlab("")+ggplot2::theme(legend.position="none")+ggplot2::ggtitle(""),
                       pl_species,
                       pl[["line11"]]+ggplot2::ylab("scores x = y")+ggplot2::xlab("")+ggplot2::theme(legend.position="none")+
                              ggplot2::ggtitle(""),
                       pl[["line1-1"]]+ggplot2::ylab("scores x = -y")+ggplot2::theme(legend.position="none")+
                         ggplot2::ggtitle(""),
                       layout_matrix = layout, widths = c(3,2),
                       top = "mytitle", left ="", right =  "")



}
\seealso{
\code{\link{doPRC}}, \code{\link{plot_sample_scores_cdt}},
\code{\link{plot_species_scores_2d}} and \code{\link[gridExtra]{grid.arrange}}
}
